<!DOCTYPE html>
<html>
<head>
    <title>Test</title>
    <script>
        (function () {
            var viewElm, particle, width = 800, height = 500;

            var Process = function (opt) {
                this.name = (opt && opt.name) || 'name';
                this.init = (opt && opt.init) || function () {};
                this.proc = (opt && opt.proc) || function () {};
            };

            Process.prototype._init = function (target) {
                target._scope = target._scope || {};
                target._scope[this.name] = target._scope[this.name] || {};
                this.init(target, target._scope[this.name]);
            };

            Process.prototype._run = function (target) {
                this.proc(target, target._scope[this.name]);
            };

            var globalGravity = new Process({
                name: 'globalGravity',
                init: function (target, scope) {
                    scope.weight = 1;
                    scope.weight_add = 0;
                },
                proc: function (target, scope) {
                    target.y += scope.weight_add;
                    scope.weight_add += scope.weight;

                    if (scope.weight_add >= 20) {
                        scope.weight_add = 20;
                    }
                }
            });

            function globalGravityProc() {
                var name = globalGravityProc.name;
                globalGravityProc.init = globalGravityProc.init || function () {
                            this[name] = this[name] || {};
                            this[name].weight = this[name].weight || 9.8;
                            this[name].weight_add = this[name].weight_add || 0;
                        };

                if (this[name]) {
                    this.y += this[name].weight_add;
                    this[name].weight_add += this[name].weight;

                    if (this[name].weight_add >= 20) {
                        this[name].weight_add = 20;
                    }
//
//                if (this.y >= height - 10) {
//                    this.y = height - 10;
//                }
                }
            }

            function decreaseProc() {
                var name = decreaseProc.name;

                function decrease(x, to_x, factor) {
                    return (to_x - x) * factor;
                }

                decreaseProc.init = decreaseProc.init || function () {
                            this[name] = this[name] || {};
                            this.to_x = this.to_x || width / 2;
                            this.to_y = this.to_y || 0;
                            this[name].speed = this[name].speed || 0.07;
                        };

                if (this[name]) {
                    this.x += decrease(this.x, this.to_x, this[name].speed);
                    this.y += decrease(this.y, this.to_y, this[name].speed);
                }
            }

            function Particle(opt) {
                this.procs = [];

                this.x = (opt && opt.x) || 0;
                this.y = (opt && opt.y) || 0;

                this.elm = document.createElement('div');
                (function (s) {
                    s.width = '10px';
                    s.height = '10px';
                    s.backgroundColor = 'white';
                    s.position = 'absolute';
                })(this.elm.style);
                viewElm.appendChild(this.elm);

                this.render = function () {
                    this.elm.style.top = this.y + 'px';
                    this.elm.style.left = this.x + 'px';
                };

                this.addProc = function (proc) {
                    this.procs = this.procs || [];

//                    proc.apply({});
//                    if (typeof proc.init === 'function') {
//                        proc.init.apply(this);
//                    }
//                    this.procs.push(proc.bind(this));
                    proc._init(this);
                    this.procs.push(proc);
                };

                this.animate = function () {
                    var particle = this;
                    this.procs.forEach(function (proc) {
                        proc._run(particle);
                    });
                };
            }

            window.onload = function () {
                viewElm = document.querySelector('#view');
                viewElm.style.width = width + 'px';
                viewElm.style.height = height + 'px';

                particle = new Particle();
//                particle.addProc(globalGravityProc);
//                particle.addProc(decreaseProc);
                particle.addProc(globalGravity);

                viewElm.onclick = function (e) {
                    particle.to_x = e.offsetX;
                    particle.to_y = e.offsetY;
                };

                requestAnimationFrame(renderLoop);
                setInterval(logicLoop, 1000 / 60);
            };

            function renderLoop() {
                particle.render();
                window.requestAnimationFrame(renderLoop);
            }

            function logicLoop() {
                particle.animate();
            }
        })();
    </script>

    <style>
        body {
            margin: 0;
            border: 0;
        }

        #view {
            background-color: #0066bb;
        }
    </style>
</head>

<body>
<div id="view"></div>
</body>
</html>